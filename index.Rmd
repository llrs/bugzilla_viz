---
title: "Exploring the R bugzilla"
author: "Llu√≠s Revilla Sancho"
date: "8/28/2021"
output: 
  html_document:
    toc: true
    toc_float: true 
    code_folding: hide
self_contained: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, collapse = TRUE, fig.width = 10)
```

# Introduction

This is an analysis of the [database dump](https://bugs.r-project.org/db/R-bugs.sql.xz) provided by on `25/03/2021` by Simon Urbanek which is available to all at the previous link.

The goal of this analysis is to identify good practices (or lack of them) to help people submitting better issues and implement helpful advice and rail guard on it to be helpful to the R core members.

# Connecting to the database dump

```{r connection, include=FALSE}
library("dbplyr")
library("RSQLite")
library("RMySQL")
# Connecting R with MySQL
db_bugzilla <- dbConnect(RMySQL::MySQL(), dbname = "rbugs", user = "tester",
                 password = "password-Tester1!",
                 host = "127.0.0.1")
```

```{r setup-db}
library("dbplyr")
library("dplyr")
library("RSQLite")
library("RMySQL")
DBI::dbListTables(db_bugzilla)
```

First an initial exploration of the database and bug reports:

```{r setup-viz}
library("ggplot2")
library("patchwork")
library("ggpattern") # from github: coolbutuseless/ggpattern
library("forcats")
theme_set(theme_minimal())
```

Building on the [previous analysis](https://llrs.github.io/bugzilla_viz/bugRzilla_review.html) we convert some columns to dates:

```{r first-plot}
library("lubridate")
date_columns_bugs <- c("creation_ts", "delta_ts", "lastdiffed", "deadline")
db_bugs <- tbl(db_bugzilla, "bugs") %>% 
    collect() %>% 
    mutate(across(!!date_columns_bugs, as.POSIXct, tz = "UTC", format = "%Y-%m-%d %H:%M:%OS"))
db_bugs %>% 
    ggplot() +
    geom_point(aes(creation_ts, bug_id, color = bug_id)) +
    labs(title = "Bugs created", y = "ID", x = "Creation") +
    guides(color = "none")
```

There are also three points that do not follow the general expectations[^1].

[^1]: If you explore the code, the warning tells us that there are some bugs without date of creation.

# Exploring outliers

```{r special-bugs}
special_bugs <- c(1, 1261, 1605)
```

These three odd bug reports need some exploration.
If we look at the bug report of the first bug you'll realize the first bug is testing bugzilla!
This together with the bugs with missing creation date indicates that some data is wrong.
But let's explore them:

```{r bug-reporter}
db_bugs %>% 
  count(reporter, sort = TRUE) %>% 
  head() %>% 
  knitr::kable(align = "c")
```

From approximately `r as.Date(min(db_bugs$creation_ts[db_bugs$bug_id != 2], na.rm = TRUE))` bugs are filled on Bugzilla.
Previously they were reported on Jitterbug (clear if you looks on the website who reported that bug, for example [3](https://bugs.r-project.org/show_bug.cgi?id=3)).

Not clear what happens on [1261](https://bugs.r-project.org/show_bug.cgi?id=1261) or [1605](https://bugs.r-project.org/show_bug.cgi?id=1605).

# Jitterbug and bugzilla

The R project moved from Jitterbug to Bugzilla, so the reporting of bugs changed too.
There were some [troubles migrating](https://stat.ethz.ch/pipermail/r-devel/2010-March/056954.html) the bugs and it is not completely clear when the switch happened.

```{r databases-storage}
db_bugs2 <- db_bugs %>% 
  mutate(reported_on = ifelse(reporter == 2, "Jitterbug", "Bugzilla"),
         reported_on = factor(reported_on, levels = c("Jitterbug", "Bugzilla")))
moving_date <- max(db_bugs2$creation_ts[db_bugs2$reported_on == "Jitterbug"], 
                   na.rm = TRUE)
db_bugs2 <- db_bugs2 %>% 
  mutate(modified_on = ifelse(delta_ts >= moving_date, "Bugzilla", "Jitterbug")) %>% 
  mutate(modified_on = ifelse(is.na(modified_on), "Jitterbug", modified_on)) %>% 
  mutate(modified_on  = ifelse(reported_on == "Bugzilla", "Bugzilla", modified_on))

db_bugs2 %>% 
  count(bug_status, resolution, reported_on, sort = TRUE) %>% 
  mutate(resolution = ifelse(resolution == "", "Not resolved", resolution)) %>% 
  ggplot() +
  geom_tile(aes(bug_status, resolution, fill = n)) +
  facet_wrap(~reported_on) +
  labs(fill = "Bugs", x = "Status", y = "Resolution")
```

Looking at the bugs filled on each issue tracker we can observe some new resolutions to bugs: SPAM :( But also new status Verified, Unconfirmed, Resolved, Confirmed. We can check out the missing issues and spam to see what happened:

```{r missing}
missing_ids <- (db_bugs2$bug_id - lag(db_bugs2$bug_id) -1)
missing_ids[db_bugs2$resolution == "SPAM"] <- 1
missing_ids[is.na(missing_ids)] <- 0
data.frame(bug = db_bugs2$creation_ts, 
           spam = missing_ids, 
           reported_on = db_bugs2$reported_on) %>%
  filter(spam != 0) %>% 
  ggplot() +
  geom_point(aes(bug, spam, color = reported_on, shape = reported_on)) +
  geom_vline(xintercept = as_datetime("2016-07-10")) +
  labs(title = "Battle against spam",
       y = "Missing bugs or SPAM",
       col = "Site",
       shape = "Site",
       x = element_blank())
```

There are two waves of missing or spam bugs on Jitterbug and later less problems on the move to Bugzilla.

It could also be that there were some problem migrating bugs from Jitterbug and some issues were not correctly moved, or simply that some issues are omitted due to the [security vulnerability policy](https://www.r-project.org/bugs.html) to omit them from appearing on the database.

But I think that the wave of spam or missing on Bugzilla that is the same day a new SPAM policy was enacted (vertical line) shows that these numbers show mostly spam.
Clearly there were like two waves of spam on Jitterbug, and since the move to Bugzilla there has been some constant but low volume spam issue compared to Jitterbug.
After the last measure to prevent spam was set very few bugs reports considered spam have been filled.

The measure was to ask permission for an account, started where the vertical line is, has worked very well.
There seem to be less missing/spam bugs lately.
Given all that we will omit the spam bugs from now on.
They are not really bug reports nor report or have something of quality to learn from them.

```{r real-bugs}
db_bugs3 <- db_bugs2 %>% 
  filter(resolution != "SPAM") %>% 
  mutate(bug_severity = fct_relevel(bug_severity, 
                                    c("trivial", "minor", "normal", "major", "blocker", "enhancement")))
db_bugs3 %>% 
  count(bug_severity, bug_status, modified_on, sort = TRUE) %>% 
  ggplot() +
  geom_tile(aes(bug_severity, bug_status, fill = n)) +
  facet_wrap(~modified_on) +
  labs(x = "Severity", y = "Status", fill = "Bugs")
```

Removing this spam messages show that either on Jitterbug there was no way to classify bugs or that this information was lost.

```{r real-bugs-bugzilla}
db_bugs4 <- db_bugs3 %>% 
  filter(reported_on == "Bugzilla",
         bug_id != 1)
db_bugs4 %>% 
  count(bug_severity, bug_status, sort = TRUE) %>% 
  ggplot() +
  geom_tile(aes(bug_severity, bug_status, fill = n)) +
  labs(x = "Severity", y = "Status", fill = "Bugs", title = "Bugs on Bugzilla")
```

If we focus only on Bugzilla, most bugs are "normal" but some classification is done on the status and severity.
Should someone help classify the bugs to different severity to prioritize working on them?

If we look at the attachments we might get some information about the kind of patches, packages, or reproducible examples that are provided.

```{r attachments}
db_attachments <- tbl(db_bugzilla, "attachments") %>% 
  collect() %>% 
  mutate(across(c("creation_ts", "modification_time"), as.POSIXct, format = "%Y-%m-%d %H:%M:%OS", tz = "UTC"))
db_attachments_bugs <- db_bugs3 %>% 
    left_join(db_attachments, by = "bug_id", suffix = c(".bug", ".at"))
db_attachments_bugs %>% 
  group_by(bug_id, reported_on) %>% 
  summarize(attachments = sum(!is.na(creation_ts.at))) %>% 
  ungroup() %>% 
  ggplot() +
  geom_bar(aes(attachments, fill = reported_on)) +
  facet_wrap(~reported_on, scales = "free_x") +
  labs(fill = "Reported on")
```

Most bug reports don't have attachments!
So this means that they are just some reporting of a problem which the R core then needs to understand and figure a solution.
Surprisingly some bug reports have many attachments, this might be related to a refinement on patches or exploring several options.

```{r attachemnt-reported}
db_attachments_bugs %>% 
  group_by(bug_id) %>% 
  summarize(have_attachments = any(!is.na(creation_ts.at)),
            x = creation_ts.bug,
            y = bug_id,
            reported_on = reported_on) %>% 
  ungroup() %>% 
  count(reported_on, have_attachments, sort = TRUE) %>%
  knitr::kable(align = "c")
```

Proportionally there are more attachments on bugzilla.

# Attachments

Perhaps some attachments weren't moved from Jitterbug, but it seems that the large difference might be from an increase in participation and patches proposed on Bugzilla.

```{r attachments-status}
attachments_type <- db_attachments_bugs %>% 
  group_by(bug_severity, bug_status, bug_id, reported_on) %>% 
  summarize(have_attachments = any(!is.na(creation_ts.at)),
            n_attachments = sum(!is.na(creation_ts.at))/n()) %>% 
  ungroup() %>% 
  group_by(bug_severity, bug_status, reported_on) %>% 
  count(n_attachments) %>% 
  mutate(attached = n_attachments > 0) %>%
  group_by(bug_severity, bug_status, reported_on) %>% 
  mutate(p = n/sum(n)) %>% 
  filter(attached)

attachments_type %>% 
  filter(reported_on == "Bugzilla") %>% 
  ggplot() +
  geom_tile(aes(bug_severity, bug_status, fill = p)) +
  scale_fill_viridis_c(labels = scales::percent_format(), limits = c(0, 1)) +
  labs(title = "Percentage of issues with attachments",
       subtitle = "On bugzilla", fill = "Attachments",
       x = "Severity", y = "Status") 
```

Looking at which severity has more attachments and which status, is kind of confusing.
Probably the attachment is more related to who is reporting the bug or people proposing solutions.

What is the time between posting the bug and the attachments?

```{r attachment-time}
attachment_time <- db_attachments_bugs %>% 
    filter(!is.na(creation_ts.at),
           !is.na(creation_ts.bug)) %>% 
    filter(reported_on == "Bugzilla") %>% 
    mutate(t = creation_ts.at - creation_ts.bug,
           mt0 = t == 0)
attachment_in <- attachment_time %>%
  filter(!mt0) %>% 
  group_by(bug_id) %>% 
  arrange(t) %>% 
  slice_head(n = 1) %>% 
  ungroup() %>% 
  summarize(attachment_in = as.numeric(median(t), units = "hours")) %>% 
  pull(attachment_in)
attachment_time %>% 
  count(mt0) %>% 
  mutate(p = round(n/sum(n)*100, 2)) %>% 
  knitr::kable(col.names = c("Attachment on  opening", "Bugs", "%"), align = "c")
```

Bugs with attachments on opening are almost 50% and when not on opening there is an attachment in around `r`attachment_in\` hours.

Exploring some issues like [7022](https://bugs.r-project.org/show_bug.cgi?id=7022) it seems that changes on tagging and notes is posted as comments.
If we want to look at comments and time between changes this will distort the results, even more, we want to improve bug reports for Bugzilla not jitterbug.
So from now we will only work with Bugzilla bugs.

```{r attachment-type-file}
db_attachments_bugs %>% 
  filter(reported_on == "Bugzilla",
         !is.na(mimetype)) %>% 
  group_by(ispatch) %>% 
  count(mimetype, sort = TRUE) %>% 
  head(8) %>% 
  knitr::kable(row.names = FALSE, align = "c")
```

Most files attached are not patches, even not all plain text files attached are patches.
They might be packages showing the issues, plots where the deffect is apparent or files with data for examples.

```{r attachment-type-people}
db_attachments_bugs %>% 
  filter(reported_on == "Bugzilla",
         !is.na(mimetype)) %>% 
  group_by(ispatch) %>% 
  count(submitter_id, sort = TRUE) %>% 
  ggplot() +
  geom_bar(aes(n, fill = factor(ispatch, labels = c("Patch", "Other"),
                                levels = c(1, 0)))) +
  labs(fill = "", y = "Users", x = "Attachments")
```

Most people submit just one file and few submit more than file.
Of those there are very few patches (as detected by the system) This might suggest that people either don't find bugs easy to patch, (or know how to do that) or they provide patches through other ways (r-devel mailing list for instance).

# Activity on bugs reports

The bugs reports receive some attention and change if people performs some action through the Bugzilla tracker.
If we look at the changes and addition to bugs we might get some idea of what is needed or missing from bug reports:

```{r activity}
db_activity <- tbl(db_bugzilla, "bugs_activity") %>% 
  collect() %>% 
  mutate(bug_when = as.POSIXct(bug_when, tz = "UTC", format = "%Y-%m-%d %H:%M:%OS")) %>% 
  filter(bug_id %in% db_bugs4$bug_id)

field_names <- c(
  "2" = "Summary", 
  "5" = "Version", 
  "6" = "Hardware", 
  "7" = "URL",
  "8" = "OS", 
  "9" = "Status", 
  "11" = "Keywords", 
  "12" = "Resolution",
  "13" = "Severity", 
  "14" = "Priority", 
  "15" = "Component", 
  "16" = "Assignee",
  "20" = "CC", 
  "21" = "Depends on", 
  "22" = "Blocks", 
  "23" = "Attachment description",
  "25" = "Attachment mime type", 
  "26" = "Attachment is patch",
  "27" = "Attachment is obsolete", 
  "34" = "?", 
  "36" = "Ever confirmed",
  "39" = "Group", 
  "40" = "?", 
  "41" = "?", 
  "42" = "Deadline", 
  "47" = "?",
  "54" = "See Also"
)
db_activity2 <- db_activity %>% 
  mutate(field = field_names[as.character(fieldid)])

db_activity2 %>% 
  count(field, adding = ifelse(removed %in% c("", "0"), "Added", "Changed")) %>%
  tidyr::pivot_longer(cols = adding,
                      names_to = "type", values_to = "value") %>% 
  ggplot() +
  geom_tile(aes(value, fct_reorder(field, n, .fun = sum), fill = n)) +
  scale_fill_viridis_c(trans = "log10") +
  labs(x = element_blank(), y = element_blank(), title = "Actions on bugs",
       fill = "Bugs")
```

Changes on bug are on status, or people subscribing (usually via commenting on the issue).
The ones that users can work to improve and provide better version description and title (Summary), followed by the severity, assigning to the right group, choosing the right OS, component and hardware.

```{r bugs-activity}
db_activity2 %>% 
  count(bug_id, sort = TRUE) %>% 
  count(n) %>% 
  mutate(n = as.factor(n)) %>% 
  ggplot() +
  geom_col(aes(x = n, y = nn)) +
  labs(x = "Activity", y = "Bugs", title = "Activity on bugs")
```

Usually issues receive around 4 modifications, probably status, CC and resolution and version.
Let's check which are the fields most often changed:

```{r bugs-common-activity}
db_activity2 %>% 
    select(bug_id, field) %>% 
    arrange(bug_id, field) %>% 
    group_by(bug_id) %>% 
    summarize(fields = list(unique(field))) %>% 
    ungroup() %>% 
    count(fields, sort = TRUE) %>% 
    mutate(size = lengths(fields)) %>% 
    filter(n > 100) %>% 
    pull(fields) %>% 
    vapply( paste, collapse = ", ", FUN.VALUE = character(1L))
```

Adding someone as CC usually means that they have commented.
So surprisingly some change resolution but no one else comments.
While 3 of the 5 more common activities involve adding someone as CC.
So how many comments are on issues?

# Comments on bug reports

Looking at the comments on bug reports we we'll see how much exchange is there usually:

```{r comments}
db_comments <- db_bugzilla %>% 
  tbl("longdescs") %>% 
  collect() %>% 
  mutate(bug_when = as.POSIXct(bug_when, tz = "UTC", 
                               format = "%Y-%m-%d %H:%M:%OS")) %>% 
  filter(bug_id %in% db_bugs4$bug_id)

db_comments %>% 
  count(bug_id) %>% 
  count(n) %>% 
  mutate(n = n) %>% 
  ggplot() +
  geom_col(aes(n, nn)) +
  # scale_y_continuous(trans = "log10") +
  labs(x = "Comments", y = "Bugs", title = "Comments on bugs")
```

This means that usually there are around 3 comments on each issue.
Some issues create long threads of over 50 comments!

```{r comments-n}
db_comments %>% 
  group_by(bug_id) %>%
  summarise(n_commenters = n_distinct(who)) %>% 
  count(n_commenters) %>% 
  mutate(n_commenters = as.factor(n_commenters)) %>% 
  ggplot() +
  geom_col(aes(n_commenters, n)) +
  # scale_y_continuous(trans = "log10") +
  labs(x = "Users", y = "Bugs")
```

Most comments on bugs are from 2 different people.
Presumably one is the author and another user (here the initial opening comment is not accounted for).

```{r users-core}
r_core <- c(3, 5, 9, 18, 19, 28, 34, 54, 137, 151, 216, 308, 413, 420, 1249, 
            1330, 2442)
w <- count(db_comments, who, sort = TRUE)
w2 <- w$n
names(w2) <- as.character(w$who)
f <- fgsea::fgsea(pathways = list("R core"= as.character(r_core)), stats = w2, 
                  scoreType = "pos")
fgsea::plotEnrichment(r_core, stats = w2) + labs(title = "R core commenters")
```

The users that comment most are from the R core.

```{r comments-core}
db_comments %>% 
  merge(db_bugs4, by = "bug_id") %>% 
  group_by(bug_id) %>% 
  summarize(author = ifelse(any(who %in% r_core), "R core", "Others"),
            bug_severity = unique(bug_severity[!is.na(bug_severity)]),
            resolution = unique(resolution[!is.na(resolution)])) %>% 
  ungroup() %>% 
  count(author, bug_severity, resolution, sort = TRUE)  %>% 
  group_by(bug_severity, resolution) %>% 
  mutate(p = n/sum(n)) %>% 
  filter(author != "Others") %>% 
  ggplot() +
  geom_tile(aes(bug_severity, resolution, fill = p)) +
  scale_fill_viridis_c(labels = scales::percent_format()) +
  labs(title = "Issues commented by the R core", 
       x = "Severity", y = "Resolution", fill = "%")
```

There seems to be less comments from the R core on trivial bugs.
On all the other seems to be above 50% of comments from the R core.

```{r status-resolution}
db_comments %>% 
  merge(db_bugs4, by = "bug_id") %>% 
  group_by(bug_id) %>% 
  summarize(author = ifelse(any(who %in% r_core), "R core", "Others"),
            bug_status = unique(bug_status[!is.na(bug_status)]),
            resolution = unique(resolution[!is.na(resolution)])) %>% 
  ungroup() %>% 
  count(author, bug_status, resolution, sort = TRUE)  %>% 
  group_by(bug_status, resolution) %>% 
  mutate(p = n/sum(n)) %>% 
  filter(author != "Others") %>% 
  ggplot() +
  geom_tile(aes(bug_status, resolution, fill = p)) +
  scale_fill_viridis_c(labels = scales::percent_format()) +
  labs(title = "Issues commented by the R core", 
       x = "Status", y = "Resolution", fill = "%")
```

As expected the R core has yet to comment on NEW bug reports but otherwise it doesn't seem that there is some problem with comments on specific categories that might reduce the R core involvement with a specific category.

```{r comments-speed}
comments_time <- db_comments %>% 
  merge(db_bugs4, by = "bug_id", all = TRUE) %>% 
  mutate(diff_t = difftime(bug_when, creation_ts, units = "hours")) %>% 
  group_by(bug_id) %>% 
  arrange(diff_t) %>% 
  mutate(n = seq_len(n())) %>% 
  ungroup() %>% 
  filter(n != 1) %>% 
  mutate(n = n-1)

ggplot(comments_time) +
  geom_line(aes(n, diff_t, col = bug_id, group = bug_id)) +
  scale_y_continuous(expand = expansion()) +
  scale_x_continuous(expand = expansion())
```

Looking at the when comments happens it seems that there are two groups of issues.
One group where it takes long time to receive the first comment.
And another group where lots of comments pour in the first hours and much later a some more comments.

```{r table-comments-time}
comments_time %>% 
  group_by(n_comments = n) %>% 
  summarize(median = median(diff_t, na.rm = TRUE),
            sd = sd(diff_t, na.rm = TRUE),
            n = n()) %>% 
  ungroup() %>% 
  head() %>% 
  knitr::kable(align = "c")
```

The first comment of an issue is usually quite fast but there are many bugs that their first comment is around a year later. 
```{r comments-authors}
comments_time %>% 
  group_by(bug_id) %>% 
  summarize(n_who = n_distinct(who), n_comments = n()) %>% 
  ungroup() %>% 
  ggplot() +
  geom_count(aes(n_who, n_comments)) +
  scale_y_continuous(expand = expansion()) +
  scale_x_continuous(expand = expansion()) +
  # scale_size(trans = "log10", range = c(0, 5)) +
  labs(size = "Bugs", x = "Authors", y = "Comments") +
  geom_abline(slope = 1, intercept = 0, col = "red")
```

Comments on bugs are usually from a small number of authors. 
But often they exchange around 10 comments. 

# Closing bug reports

One of the current tasks the R core does is closing and replying to issues.
Issues might get closed for a variety of reasons as we have seen, but maybe there is some hint to something bugRzilla could help:

```{r bug_status, warning=FALSE}
db_activity_bugs <- db_activity2 %>% 
  merge(db_bugs4, by = "bug_id", all.y = TRUE)

closing_time <- db_activity_bugs %>% 
  group_by(bug_id) %>% 
  summarize(
    creation_t = unique(creation_ts),
    closed_t = max(bug_when[added == "CLOSED"])) %>% 
  ungroup() %>% 
  mutate(diff_t = difftime(closed_t, creation_t, units = "hours")) %>% 
  mutate(diff_t = if_else(closed_t < as.difftime(0, units = "hours") | is.na(closed_t), as.difftime("NA", units = "hours"), diff_t)) %>% 
  mutate(closed = !is.na(diff_t == 0))

closing_time %>%   
  ggplot() +
  geom_point(aes(x = creation_t, y = bug_id), col = "green", shape = 17, size = 1) +
  geom_point(aes(x = closed_t, y = bug_id), col = "red", size = 1, data = . %>% filter(closed), alpha = 0.25) +
  scale_x_datetime(date_breaks = "1 year", date_labels = "%Y") +
  labs(x = element_blank(), y = "Bug", title = "Opening and closing bugs")
```

We can observe the rise of bug reports and the closing efforts.
On mid 2014 there was some effort to close issues, and a big effort to close old issues on 2015-2016.
More recently the effect of ["R Can Use Your Help: Reviewing Bug Reports"](https://developer.r-project.org/Blog/public/2019/10/09/r-can-use-your-help-reviewing-bug-reports/index.html) is also appreciable but the closing effort seems more organic as it spans almost all 2020 closing old bug reports and it is not focused on a short span of time.

```{r bug-closed-month}
closing_time %>%   
  filter(closed) %>% 
  group_by(month = format(closed_t, "%Y-%m")) %>% 
  count() %>% 
  ggplot() +
  geom_col(aes(x = month, y = n)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(expand = expansion()) +
  labs(x = element_blank(), y = "Closed issues")
```

The big spike of near 500 closed issues on 2015-12 (presumably automatic), distorts a bit the graphic.

```{r bug-closed-month2}
closing_time %>%   
  filter(closed) %>% 
  group_by(month = format(closed_t, "%Y-%m")) %>% 
  count() %>% 
  ggplot() +
  geom_col(aes(x = month, y = n)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) +
  coord_cartesian(ylim = c(0, 65)) +
  scale_y_continuous(expand = expansion()) +
  labs(x = element_blank(), y = "Closed issues")
```

With near to 20 bugs closed each month, the question is which ones are closed faster?
Perhaps some kind of resolution or status of bugs are closed sooner?

```{r time-resolution-severity-closed}
db_bugs4 %>% 
  merge(closing_time, by = "bug_id", all.x = TRUE, all.y = FALSE) %>% 
  filter(closed) %>% 
  group_by(resolution, bug_severity) %>% 
  summarize(f = as.numeric(median(diff_t))) %>% 
  ungroup() %>% 
  ggplot() +
  geom_tile(aes(bug_severity, resolution, fill = f)) +
  scale_fill_viridis_c(trans = "log10") +
  labs(x = "Severity", y = "Resolution", fill = "h", 
       title = "Median time till closing the issue")
```

Usually it takes some time to close a bug report as duplicate.
Maybe this is because one needs some familiarity with the previous reported bugs.

Which bugs are harder to close or need more information?

```{r time-opened}
db_bugs4 %>% 
  merge(closing_time, by = "bug_id", all.x = TRUE, all.y = FALSE) %>% 
  filter(!closed) %>% 
  mutate(ct = difftime(as.Date("2021/03/25"), creation_t, units = "hours")) %>% 
  group_by(resolution, bug_severity) %>% 
  summarize(f = as.numeric(median(ct)), n = n()) %>% 
  ungroup() %>% 
  filter(n > 5) %>% 
  ggplot() +
  geom_tile(aes(bug_severity, resolution, fill = f)) +
  scale_fill_viridis_c(trans = "log10") +
  labs(x = "Severity", y = "Resolution", fill = "h", 
       title = "Median time of open bug report")
```

Bugs without resolution described as major are more time open, presumably because they take more time to fix too.
Next are enhancements, which makes sense that enhancements take some time till they are incorporated to R source code.
Perhaps is the effect of the recent call to help on Bugzilla but the normal bug reports seem to be the ones less time open.

# Conclusion

```{r disconnect, include=FALSE}
dbDisconnect(db_bugzilla)
```

There is room for improvements on the bug reporting process from users: 
 - Include some efforts to trace the origin of the bug report. 
 - Include a patch whenever possible or some suggestions how you think the bug could be fixed.
 - Give details of the kind of the bug or at least not always using the default options of the tracker.
 
Also some advice to bug reporters:
 - Don't expect a fast comment if the issue is complicated.
